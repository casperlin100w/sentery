<!DOCTYPE html>
<html lang="TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>註冊新帳號</title>

    <style>
        * {
            padding: 0;
            margin: 0;
            /* 修正： transform 無效，應為 transition */
            transition: .3s;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: url(登入畫面圖.png);
            /* 請替換為您的背景圖 */
            background-size: cover;
        }

        h2 {
            font-size: 30px;
            color: rgb(255, 255, 255);
            margin: 15px 0;
        }

        .shell {
            width: 400px;
            padding: 40px;
            display: flex;
            align-items: center;
            flex-direction: column;
            background-color: #4848b249;
            border-radius: 50px;
            box-shadow: 0 0 70px rgba(111, 35, 211, 0.889) inset;
        }

        /* 輸入框的基本樣式 */
        input[type="text"],
        input[type="email"],
        /* 新增 email 類型 */
        input[type="password"] {
            background: rgba(172, 151, 220, 0);
            border: 3px solid #574386;
            width: 100%;
            /* 確保輸入框填滿容器 */
            padding: 10px;
            margin: 10px 0;
            font-size: 18px;
            color: white;
            /* 讓輸入的文字為白色 */
            box-sizing: border-box;
            /* 確保 padding 不會增加寬度 */
            border-radius: 5px;
        }

        /* 輸入框懸停效果 */
        input[type="text"]:hover,
        input[type="email"]:hover,
        input[type="password"]:hover {
            border-color: #7957d5;
        }


        /* 送出 */
        input[type="submit"] {
            width: 100%;
            height: 50px;
            padding: 10px;
            margin: 50px 0;
            border: none;
            background-color: rgba(47, 38, 63, 0.5);
            color: #ffffff;
            cursor: pointer;
            font-size: 20px;
            letter-spacing: 4px;
        }

        input::placeholder {
            color: rgb(206, 207, 236);
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 20px;
        }

        /* 記住我 */
        .Remember {
            opacity: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: rgb(202, 203, 216);
            /* 在註冊頁面，我們通常不需要「記住我」的選項，但為符合登入頁結構保留 */
        }

        input[type="checkbox"] {
            display: block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            background-color: rgb(25, 34, 200);
        }

        /* 返回登入 */
        #login-btn {
            border: none;
            background-color: rgba(193, 117, 193, 0.564);
            color: rgb(187, 188, 199);
            font-size: 16px;
        }

        /* 專門用於狀態訊息的樣式 */
        #signup-message {
            margin-top: -30px;
            /* 向上微調以更靠近按鈕 */
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .message-success {
            color: #10B981;
        }

        /* 綠色 */
        .message-error {
            color: #F87171;
        }

        /* 紅色 */
        .message-info {
            color: #60A5FA;
        }

        /* 藍色 */
    </style>
</head>

<body>

    <div class="shell">
        <h2 class="title">註冊新帳號</h2>

        <input type="email" id="signup-email" placeholder="電子郵件" required>
        <input type="password" id="signup-password" placeholder="密碼 (至少 6 位)" required>
        <input type="password" id="signup-confirm-password" placeholder="確認密碼" required>

        <input type="submit" value="註冊並發送驗證郵件" id="signupBtn">

        <div id="signup-message"></div>

        <div class="footer">
            <div class="Remember" style="opacity: 0;">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">記住我</label>
            </div>

            <button id="login-btn">返回登入</button>
        </div>
    </div>

    <script type="module">
        // -------------------------------------------------------------
        // 1. 導入模組與服務初始化
        // -------------------------------------------------------------

        // 導入 Firebase 核心功能
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        // 導入 Auth 模組
        import {
            getAuth,
            createUserWithEmailAndPassword,
            sendEmailVerification,
            signOut
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

        // 您的 Web App Firebase 配置 (從組合版複製)
        const firebaseConfig = {
            apiKey: "AIzaSyCtbjdi-x3E3eNgX8WvBtgibOTRG4idny4",
            authDomain: "workai-1d692.firebaseapp.com",
            projectId: "workai-1d692",
            storageBucket: "workai-1d692.firebasestorage.app",
            messagingSenderId: "156453625217",
            appId: "1:156453625217:web:f04e2da964ddb6d449dc80",
            measurementId: "G-71NV0L4CGS"
        };

        // 初始化 Firebase App
        const app = initializeApp(firebaseConfig);
        // 服務實例
        const auth = getAuth(app);

        // 元素獲取
        const emailInput = document.getElementById('signup-email');
        const passwordInput = document.getElementById('signup-password');
        const confirmPasswordInput = document.getElementById('signup-confirm-password');
        const signupBtn = document.getElementById('signupBtn');
        const loginBtn = document.getElementById('login-btn');
        const messageDiv = document.getElementById('signup-message');

        // -------------------------------------------------------------
        // 2. 輔助函式 (顯示訊息)
        // -------------------------------------------------------------

        /**
         * 顯示訊息 (遵守無邊框純文字要求)
         * @param {string} msg 訊息內容
         * @param {string} type 訊息類型 ('success', 'error', 'info')
         */
        function showMessage(msg, type = 'info') {
            messageDiv.textContent = msg;
            messageDiv.className = '';
            messageDiv.classList.add(`message-${type}`);
        }

        // -------------------------------------------------------------
        // 3. 註冊操作
        // -------------------------------------------------------------

        const handleSignUp = async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (!email || !password || !confirmPassword) {
                showMessage('所有欄位都不能為空。', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('兩次輸入的密碼不一致。', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('密碼長度必須至少為 6 位。', 'error');
                return;
            }

            showMessage('正在嘗試註冊並發送驗證郵件...', 'info');
            signupBtn.disabled = true;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // 發送驗證郵件
                await sendEmailVerification(user);

                // 註冊成功後自動登出，以便用戶通過驗證郵件登入
                await signOut(auth);

                showMessage(`✅ 註冊成功！請檢查 ${email} 的收件箱並點擊驗證連結。即將跳轉回登入頁。`, 'success');

                // 成功後跳轉回登入頁面 (上一層資料夾)
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 3000); // 延遲 3 秒讓用戶閱讀訊息

            } catch (error) {
                signupBtn.disabled = false;
                let displayMessage = '註冊失敗。';
                if (error.code === 'auth/email-already-in-use') {
                    displayMessage = '該電子郵件已被註冊。請直接登入。';
                } else if (error.code === 'auth/weak-password') {
                    displayMessage = '密碼強度不足，請使用更複雜的密碼。';
                } else if (error.code === 'auth/invalid-email') {
                    displayMessage = '電子郵件格式不正確。';
                } else {
                    console.error("註冊錯誤:", error);
                }
                showMessage(`❌ ${displayMessage}`, 'error');
            }
        };

        // -------------------------------------------------------------
        // 4. 事件監聽器 (繫結按鈕事件)
        // -------------------------------------------------------------

        signupBtn.addEventListener('click', handleSignUp);

        // 返回登入頁面的按鈕
        loginBtn.addEventListener('click', () => {
            window.location.href = '../login/';
        });

    </script>

</body>

</html>